---
title: Riak 系统规划
project: riak
version: 1.4.2+
document: tutorials
toc: true
audience: intermediate
keywords: [planning, os]
---

面试搭建 Riak 集群的步骤，以及推荐使用的架构设计和设置。

## 后台

Riak 的后台是指存储数据的机制。不同的后台各有利弊，如果你无法确定要使用哪种后台，请阅读“[[选择后台]]”一文。

* [[Bitcask]]
* [[LevelDB]]
* [[Memory]]
* [[Multi]]

## 容量

“[[集群容量规划]]”一文大概介绍了规划 Riak 集群时要考虑的方方面面。

如果你选择使用 [[Bitcask]] 做后台，请阅读“[[Bitcask 容量规划]]”一文了解如何计算适合的容量。

## 操作系统

我们推荐把 Riak 部署在主流的类 Unix 操作系统上。主流的发行版本有较大的社区支持，更容易解决常见问题。Basho 为下列的发行版本提供了 Riak 安装包：

* **基于 Red Hat 的系统：** Red Hat Enterprise Linux, CentOS, Fedora Core
* **基于 Debian 的系统：** Debian, Ubuntu
* **基于 Solaris 的系统：** Sun Solaris, OpenSolaris

## 软件

如果你下载的是 [Basho 提供的 Riak 安装包](http://downloads.basho.com/riak/)，就无需额外的软件包了。如果从源码编译 Riak，需要在系统中安装 Erlang。Erlang 的编译和安装说明请参阅“[[安装 Erlang]]”一文。

## 硬件

在设计 Riak 时考虑了横向扩放，即添加节点时自动提升性能，不过用更强大的硬件总没坏处。下面是推荐使用的硬件：

* **64 位多核 CPU** - Riak 使用 Erlang 开发，多核就意味着更多的并发，因此性能也更好。在 64 位架构上 Riak 还能更高效的进行数字计算。
* **至少 4GB RAM** - 更大的 RAM 就能在主内存中存储更多的数据，提升读写性能和 [[MapReduce|使用 MapReduce]] 的性能。内存不足的话就会增加交换文件的使用，导致性能下降，因为内存操作变成了常规的硬盘操作。你可以使用类似 [[Bitcask 计算器|Bitcask 容量规划]]的工具计算节点需要多少内存才能满足 Bitcask 存储数据的需求。关于内存和硬盘使用更多的信息请阅读“[[集群容量规划]]”一文
* **多个高速硬盘（RAID 和/或 SSD）** - 因为 Riak 的很多操作是受 IO 限制的，所以要得到好的性能就要使用高速硬盘。你还可以把硬盘改造成 RAID0 来提升读写性能。
* **快速的网络连接（GB 级以上）** - Riak 严重依靠网络处理存储操作和集群状态（环的状态广播，移交处理等），节点直接、客户端和集群之间的很快的话就能提升性能。

## 虚拟化

和大多数数据存储程序一样，**没有被虚拟化的 Riak 性能是最好的**。虚拟机的 IO 和网络性能都不太好，这和其设置及所在的环境有关。下面是针对在 VPS 或云环境中运行 Riak 的一些建议：

* **选择你可以负担起的最大的 VM** - 好的硬件意味着好的性能。大型的虚拟机很少会和其他客户分享使用硬件资源。
* **尽量把 VM 部署在同一个数据中心或者同一地区** - 有些服务器提供商允许你选择服务器所在的位置，选择放在同一数据中心或者地区一般会减少网络迟延，提升吞吐量，因此性能也好。

## 网络设置 / 负载均衡

至少有两种策略可以增进整个集群的负载均衡，**虚拟 IP** 和**反向代理**。

对**虚拟 IP**来说，我们推荐使用任意一种 VIP 实现方式。但是不推荐使用 VRRP，因为这样做就无法把客户端的请求传遍一个环中的所有节点。

对**反向代理**设置（HTTP 接口）来说，下面任何一种都能满足需求：

* haproxy
* squid
* varnish
* nginx
* lighttpd
* Apache
